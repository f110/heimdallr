VAULT_ASSETS = {
    "1.12.0": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.12.0/vault_1.12.0_linux_amd64.zip",
                "56d140b34bec780cd458672e39b3bb0ea9e4b7e4fb9ea7e15de31e1562130d7a",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.12.0/vault_1.12.0_linux_arm64.zip",
                "8178d5d3354934eb53cceeb212e4ec4bf2a60b2ae48150a7157898288c20519e",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.12.0/vault_1.12.0_darwin_amd64.zip",
                "1042cdf626ed05734332dcbd566548f4622f4320b1c1d7aa8ec89f9fa6d32cc4",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.12.0/vault_1.12.0_darwin_arm64.zip",
                "efc6506b909c4ccc055302ff1e782b2e214b3bcbb740ce46e8cd78d0046a38f9",
            ),
        },
    },
    "1.11.4": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.11.4/vault_1.11.4_linux_amd64.zip",
                "8764a55bdd69faedaaf5d50325d5e6806041e6305b1e66454b46dc6426d26556",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.11.4/vault_1.11.4_linux_arm64.zip",
                "60d635963201b6d06abda1c2c74199931492665bc8e716417caf248865f5f9aa",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.11.4/vault_1.11.4_darwin_amd64.zip",
                "db0d27cd64c15b305cc33bc91e94bd1ad80800ee83ddf46d506c113970ae98ca",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.11.4/vault_1.11.4_darwin_arm64.zip",
                "5e01d9b4fca779403b318918adcf6500c0aa718b60471030a364b2d05da17a57",
            ),
        },
    },
    "1.10.7": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.10.7/vault_1.10.7_linux_amd64.zip",
                "c966f8501bdd14a52beee564f5290c0512ed42ae9d72e62e0bfe9198c94ff41f",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.10.7/vault_1.10.7_linux_arm64.zip",
                "ad97665ca6b9b9f1c4ac8ae8b0e21403aa50cf8a291c7da13c9187bdc66894ae",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.10.7/vault_1.10.7_darwin_amd64.zip",
                "e21394810fd972ef7d316c306da2c2e5ad9a28a43f5c1cefe287ffaca374d407",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.10.7/vault_1.10.7_darwin_arm64.zip",
                "730ec64cfddfa3615e66b9bda169446925737747101e715219429bd1bf79ebfa",
            ),
        },
    },
    "1.9.10": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.9.10/vault_1.9.10_linux_amd64.zip",
                "2898fc3e035926f23d2ac2fe3e713b32e146fd2e8320eff3b44c46700c8bb5c5",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.9.10/vault_1.9.10_linux_arm64.zip",
                "d553576a55db940d7f3561e8e94e1e098f261723ab2b51902e982b76360af211",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.9.10/vault_1.9.10_darwin_amd64.zip",
                "dccdf28f2d748e717ce644b48962159bc81c08a23d06c9a7eaeb973f6b0ef787",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.9.10/vault_1.9.10_darwin_arm64.zip",
                "92f4aa2f9e667063134116fb831cdd33e25f5227bef613cc4c44ebead5f89148",
            ),
        },
    },
    "1.8.12": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.8.12/vault_1.8.12_linux_amd64.zip",
                "88c280945db62b118435ec1bf0086a719f6b6551cba052e5f8d1e25a80884bca",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.8.12/vault_1.8.12_linux_arm64.zip",
                "e57e719e1eec9bce9057751e2583907210d3ac99c0a01897479506fbb2af828d",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.8.12/vault_1.8.12_darwin_amd64.zip",
                "b398481bf33ebf9563cf69d7639014f0d652a2d5e26c0a9a424e2a39bb853354",
            ),
            "arm64": (
                "https://releases.hashicorp.com/vault/1.8.12/vault_1.8.12_darwin_arm64.zip",
                "20aead134ef8e77cb70efcfe047fc2e381793004fba103e7692b7dab00fe5131",
            ),
        },
    },
    "1.6.3": {
        "linux": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.6.3/vault_1.6.3_linux_amd64.zip",
                "844adaf632391be41f945143de7dccfa9b39c52a72e8e22a5d6bad9c32404c46",
            ),
        },
        "darwin": {
            "amd64": (
                "https://releases.hashicorp.com/vault/1.6.3/vault_1.6.3_darwin_amd64.zip",
                "7250ab8c5e9aa05eb223cfdc3f07a4a437341ee258244062b2d0fddbe391f3d7",
            ),
        },
    },
}

def _vault_binary_impl(ctx):
    os = ""
    if ctx.os.name == "linux":
        os = "linux"
    elif ctx.os.name == "mac os x":
        os = "darwin"
    else:
        fail("%s is not supported" % ctx.os.name)
    arch = ctx.execute(["uname", "-m"]).stdout.strip()

    # On Linux, uname returns x86_64 as CPU architecture.
    if arch == "x86_64":
        arch = "amd64"

    if not ctx.attr.version in VAULT_ASSETS:
        fail("%s is not supported version" % ctx.attr.version)

    url, checksum = VAULT_ASSETS[ctx.attr.version][os][arch]
    ctx.download_and_extract(
        url = url,
        sha256 = checksum,
        type = "zip",
    )

    ctx.file("BUILD.bazel", "sh_binary(name = \"bin\", srcs = [\"vault\"], visibility = [\"//visibility:public\"])")

vault_binary = repository_rule(
    implementation = _vault_binary_impl,
    attrs = {
        "version": attr.string(),
    },
)
